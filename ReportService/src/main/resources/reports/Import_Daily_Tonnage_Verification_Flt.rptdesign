<?xml version="1.0" encoding="UTF-8"?>
<report xmlns="http://www.eclipse.org/birt/2005/design" version="3.2.23" id="1">
    <property name="createdBy">Eclipse BIRT Designer Version 4.6.0.v201606072122</property>
    <property name="units">in</property>
    <property name="iconFile">/templates/blank_report.gif</property>
    <property name="bidiLayoutOrientation">ltr</property>
    <property name="imageDPI">96</property>
    <parameters>
        <scalar-parameter name="FromDate" id="77">
            <property name="valueType">static</property>
            <property name="dataType">string</property>
            <property name="distinct">true</property>
            <list-property name="selectionList"/>
            <property name="paramType">simple</property>
            <property name="controlType">text-box</property>
            <structure name="format">
                <property name="category">Unformatted</property>
            </structure>
        </scalar-parameter>
        <scalar-parameter name="ToDate" id="78">
            <property name="valueType">static</property>
            <property name="dataType">string</property>
            <property name="distinct">true</property>
            <list-property name="selectionList"/>
            <property name="paramType">simple</property>
            <property name="controlType">text-box</property>
            <structure name="format">
                <property name="category">Unformatted</property>
            </structure>
        </scalar-parameter>
    </parameters>
    <data-sources>
        <oda-data-source extensionID="org.eclipse.birt.report.data.oda.jdbc" name="Data Source" id="4">
            <list-property name="privateDriverProperties">
                <ex-property>
                    <name>metadataBidiFormatStr</name>
                    <value>ILYNN</value>
                </ex-property>
                <ex-property>
                    <name>disabledMetadataBidiFormatStr</name>
                </ex-property>
                <ex-property>
                    <name>contentBidiFormatStr</name>
                    <value>ILYNN</value>
                </ex-property>
                <ex-property>
                    <name>disabledContentBidiFormatStr</name>
                </ex-property>
            </list-property>
            <property name="odaDriverClass">com.microsoft.sqlserver.jdbc.SQLServerDriver</property>
            <property name="odaURL">jdbc:sqlserver://cosysprodsqldb1server.database.windows.net;databaseName=NGCPROD;ApplicationIntent=ReadOnly</property>
            <property name="odaUser">SatsProdReadonlyUser</property>
            <encrypted-property name="odaPassword" encryptionID="base64">TmdjRGJSZWFkJTQ1Ng==</encrypted-property>
        </oda-data-source>
    </data-sources>
    <data-sets>
        <oda-data-set extensionID="org.eclipse.birt.report.data.oda.jdbc.JdbcSelectDataSet" name="Data Set" id="223">
            <list-property name="parameters">
                <structure>
                    <property name="name">FromDate</property>
                    <property name="paramName">FromDate</property>
                    <property name="dataType">string</property>
                    <property name="position">1</property>
                    <property name="isInput">true</property>
                    <property name="isOutput">false</property>
                </structure>
                <structure>
                    <property name="name">ToDate</property>
                    <property name="paramName">ToDate</property>
                    <property name="dataType">string</property>
                    <property name="position">2</property>
                    <property name="isInput">true</property>
                    <property name="isOutput">false</property>
                </structure>
            </list-property>
            <structure name="cachedMetaData">
                <list-property name="resultSet">
                    <structure>
                        <property name="position">1</property>
                        <property name="name">FlightDate</property>
                        <property name="dataType">string</property>
                    </structure>
                    <structure>
                        <property name="position">2</property>
                        <property name="name">Flight</property>
                        <property name="dataType">string</property>
                    </structure>
                    <structure>
                        <property name="position">3</property>
                        <property name="name">Manifest_WGT</property>
                        <property name="dataType">decimal</property>
                    </structure>
                    <structure>
                        <property name="position">4</property>
                        <property name="name">Missing_Cargo</property>
                        <property name="dataType">decimal</property>
                    </structure>
                    <structure>
                        <property name="position">5</property>
                        <property name="name">Found_Cargo</property>
                        <property name="dataType">decimal</property>
                    </structure>
                    <structure>
                        <property name="position">6</property>
                        <property name="name">Final_Manifest</property>
                        <property name="dataType">decimal</property>
                    </structure>
                    <structure>
                        <property name="position">7</property>
                        <property name="name">FrtIn_WGT</property>
                        <property name="dataType">decimal</property>
                    </structure>
                    <structure>
                        <property name="position">8</property>
                        <property name="name">BUP</property>
                        <property name="dataType">decimal</property>
                    </structure>
                    <structure>
                        <property name="position">9</property>
                        <property name="name">PER</property>
                        <property name="dataType">decimal</property>
                    </structure>
                    <structure>
                        <property name="position">10</property>
                        <property name="name">BUPPER</property>
                        <property name="dataType">decimal</property>
                    </structure>
                    <structure>
                        <property name="position">11</property>
                        <property name="name">DGR</property>
                        <property name="dataType">decimal</property>
                    </structure>
                    <structure>
                        <property name="position">12</property>
                        <property name="name">GEN</property>
                        <property name="dataType">decimal</property>
                    </structure>
                    <structure>
                        <property name="position">13</property>
                        <property name="name">Billing_Total</property>
                        <property name="dataType">decimal</property>
                    </structure>
                    <structure>
                        <property name="position">14</property>
                        <property name="name">Variance (kg)</property>
                        <property name="dataType">decimal</property>
                    </structure>
                    <structure>
                        <property name="position">15</property>
                        <property name="name">Variance %</property>
                        <property name="dataType">decimal</property>
                    </structure>
                </list-property>
            </structure>
            <property name="dataSource">Data Source</property>
            <list-property name="resultSet">
                <structure>
                    <property name="position">1</property>
                    <property name="name">FlightDate</property>
                    <property name="nativeName">FlightDate</property>
                    <property name="dataType">string</property>
                </structure>
                <structure>
                    <property name="position">2</property>
                    <property name="name">Flight</property>
                    <property name="nativeName">Flight</property>
                    <property name="dataType">string</property>
                </structure>
                <structure>
                    <property name="position">3</property>
                    <property name="name">Manifest_WGT</property>
                    <property name="nativeName">Manifest_WGT</property>
                    <property name="dataType">decimal</property>
                </structure>
                <structure>
                    <property name="position">4</property>
                    <property name="name">Missing_Cargo</property>
                    <property name="nativeName">Missing_Cargo</property>
                    <property name="dataType">decimal</property>
                </structure>
                <structure>
                    <property name="position">5</property>
                    <property name="name">Found_Cargo</property>
                    <property name="nativeName">Found_Cargo</property>
                    <property name="dataType">decimal</property>
                </structure>
                <structure>
                    <property name="position">6</property>
                    <property name="name">Final_Manifest</property>
                    <property name="nativeName">Final_Manifest</property>
                    <property name="dataType">decimal</property>
                </structure>
                <structure>
                    <property name="position">7</property>
                    <property name="name">FrtIn_WGT</property>
                    <property name="nativeName">FrtIn_WGT</property>
                    <property name="dataType">decimal</property>
                </structure>
                <structure>
                    <property name="position">8</property>
                    <property name="name">BUP</property>
                    <property name="nativeName">BUP</property>
                    <property name="dataType">decimal</property>
                </structure>
                <structure>
                    <property name="position">9</property>
                    <property name="name">PER</property>
                    <property name="nativeName">PER</property>
                    <property name="dataType">decimal</property>
                </structure>
                <structure>
                    <property name="position">10</property>
                    <property name="name">BUPPER</property>
                    <property name="nativeName">BUPPER</property>
                    <property name="dataType">decimal</property>
                </structure>
                <structure>
                    <property name="position">11</property>
                    <property name="name">DGR</property>
                    <property name="nativeName">DGR</property>
                    <property name="dataType">decimal</property>
                </structure>
                <structure>
                    <property name="position">12</property>
                    <property name="name">GEN</property>
                    <property name="nativeName">GEN</property>
                    <property name="dataType">decimal</property>
                </structure>
                <structure>
                    <property name="position">13</property>
                    <property name="name">Billing_Total</property>
                    <property name="nativeName">Billing_Total</property>
                    <property name="dataType">decimal</property>
                </structure>
                <structure>
                    <property name="position">14</property>
                    <property name="name">Variance (kg)</property>
                    <property name="nativeName">Variance (kg)</property>
                    <property name="dataType">decimal</property>
                </structure>
                <structure>
                    <property name="position">15</property>
                    <property name="name">Variance %</property>
                    <property name="nativeName">Variance %</property>
                    <property name="dataType">decimal</property>
                </structure>
            </list-property>
            <xml-property name="queryText"><![CDATA[-------------------------------------------
--Import
--Daily Tonnage Verification Report
--Flight level
--------------------------------------------
WITH 
Flight AS (Select leg.Flight_ID FlightId, Flt.CarrierCode, Flt.FlightNumber, Flt.FlightKey, 
                 UPPER(FORMAT(Cast(Leg.DateSTA As Date),'dd MMM yyyy')) FlightDate
           From   Flt_OperativeFlight Flt
		   INNER JOIN Flt_OperativeFlight_Legs leg 
		           ON leg.Flight_ID = Flt.Flight_ID
		   WHERE Leg.FlightOffPoint = 'SIN'     
		   AND   ( (Flt.carriercode in ('MU','CK') AND cast(Leg.DATESTA as date) >= '11-DEC-2018')
			      OR (Flt.carriercode in ('VJ','PN','RX') AND cast(Leg.DATESTA as date) >= '27-DEC-2018')
				  OR (Flt.carriercode in ('TG','BR','FJ','LO') AND cast(Leg.DATESTA as date) >= '03-JAN-2019')
				  OR (Flt.carriercode in ('BG','SL','OD','JT','ID','HU','GX','5J','3U') AND cast(Leg.DATESTA as date) >= '26-FEB-2019')
				  OR (Flt.carriercode in ('CZ','CV','LX','MF','NS','OZ','QZ','Z2','ZH','FD','AK','CA','JL','HO')	AND cast (Leg.DATESTA as date) >= '19-MAR-2019')
				  OR (Flt.carriercode in ('AI','7L','9W','PR','IX','BI','EY','ET','BS','SV','BL','HY') AND cast (Leg.DATESTA as date) >= '27-MAR-2019')
				  OR (Flt.carriercode = '3K' AND cast (Leg.DATESTA as date) BetWeen '27-MAR-2019' And '28-MAR-2019')
				  OR (Flt.carriercode In ('PX','VN') AND cast (Leg.DATESTA as date) BetWeen '27-MAR-2019' And '14-APR-2019')
				  OR (Flt.carriercode = 'UA' AND cast(Leg.DATESTA as date)  >= '30-APR-2019')
				  OR (Flt.carriercode = 'TK' AND cast(Leg.DATESTA as date)  >= '09-MAY-2019')				  
				  OR (Flt.carriercode In ('NH','NQ') AND cast(Leg.DATESTA as date)  >= '15-MAY-2019') 
				  OR (Flt.carriercode = 'CX' AND cast(Leg.DATESTA as date)  >= '21-MAY-2019')
				  OR (Flt.carriercode = 'KE' AND cast(Leg.DATESTA as date)  >= '28-MAY-2019')	
				  OR (Flt.carriercode = 'VN' AND cast(Leg.DATESTA as date)  >= '04-JUN-2019')
				  OR (Flt.carriercode = '3K' AND cast(Leg.DATESTA as date)  >= '11-JUN-2019')
				  OR (Flt.carriercode = 'KZ' AND cast(Leg.DATESTA as date)  >= '12-JUN-2019')	
				  OR (Flt.carriercode = 'FX' AND cast(Leg.DATESTA as date)  >= '18-JUN-2019')
				  OR (Flt.carriercode = 'RU' AND cast(Leg.DATESTA as date)  >= '25-JUN-2019')
				  OR (Flt.carriercode In ('TH','N7') AND cast(Leg.DATESTA as date)  >= '02-JUL-2019')	
				OR ( Flt.carriercode = 'LH' AND Cast(Leg.datesta AS DATE) >= '11-JUL-2019' ) 
				OR ( Flt.carriercode = '8K' AND Cast(Leg.datesta AS DATE) >= '16-JUL-2019' ) 
				OR ( Flt.carriercode = '3S' AND Cast(Leg.datesta AS DATE) >= '19-JUL-2019' ) 
				OR ( Flt.carriercode = 'JQ' AND Cast(Leg.datesta AS DATE) >= '29-JUL-2019' ) 
				OR ( Flt.carriercode = 'QF' AND Cast(Leg.datesta AS DATE) >= '29-JUL-2019' )			
				OR ( Flt.carriercode = 'PX' AND Cast(Leg.datesta AS DATE) >= '27-AUG-2019' )
				OR ( Flt.FlightKey = 'SQ0278' AND Cast(Leg.datesta AS DATE) >= '02-SEP-2019' )
				OR ( Flt.flightkey = 'MI0921' AND Cast(Leg.datesta AS DATE) >= '10-SEP-2019' )
				OR ( Flt.flightkey = 'SQ0181' AND Cast(Leg.datesta AS DATE) >= '13-SEP-2019' )
				OR ( Flt.flightkey = 'SQ0655' AND Cast(Leg.datesta AS DATE) >= '17-SEP-2019' )	
				OR ( Flt.flightkey = 'SQ0479' AND Cast(Leg.datesta AS DATE) >= '27-SEP-2019' )
				OR ( Flt.flightkey = 'SQ0481' AND Cast(Leg.datesta AS DATE) >= '27-SEP-2019' )
				OR ( Flt.flightkey = 'SQ0447' AND Cast(Leg.datesta AS DATE) >= '01-OCT-2019' )
				OR ( Flt.flightkey = 'SQ0449' AND Cast(Leg.datesta AS DATE) >= '02-OCT-2019' )	
				OR ( Flt.flightkey = 'TR0531' AND Cast(Leg.datesta AS DATE) >= '03-OCT-2019' )
				OR ( Flt.flightkey = 'SQ0278' AND Cast(Leg.datesta AS DATE) >= '08-OCT-2019' )
				OR ( Flt.flightkey = 'SQ4282' AND Cast(Leg.datesta AS DATE) >= '08-OCT-2019' )
				OR ( Flt.flightkey = 'SQ4284' AND Cast(Leg.datesta AS DATE) >= '08-OCT-2019' )
				OR ( Flt.flightkey = 'SQ0286' AND Cast(Leg.datesta AS DATE) >= '08-OCT-2019' )
				OR ( Flt.flightkey = 'SQ7297' AND Cast(Leg.datesta AS DATE) >= '08-OCT-2019' )
				OR ( Flt.flightkey = 'SQ7289' AND Cast(Leg.datesta AS DATE) >= '08-OCT-2019' )
				OR ( Flt.flightkey = 'SQ7293' AND Cast(Leg.datesta AS DATE) >= '08-OCT-2019' )
				OR ( Flt.flightkey = 'SQ0266' AND Cast(Leg.datesta AS DATE) >= '08-OCT-2019' )
				OR ( Flt.flightkey = 'SQ0246' AND Cast(Leg.datesta AS DATE) >= '08-OCT-2019' )
				OR ( Flt.flightkey = 'SQ0256' AND Cast(Leg.datesta AS DATE) >= '08-OCT-2019' )
				OR ( Flt.flightkey = 'SQ0236' AND Cast(Leg.datesta AS DATE) >= '08-OCT-2019' )
				OR ( Flt.flightkey = 'SQ0298' AND Cast(Leg.datesta AS DATE) >= '08-OCT-2019' )
				OR ( Flt.flightkey = 'SQ0208' AND Cast(Leg.datesta AS DATE) >= '08-OCT-2019' )
				OR ( Flt.flightkey = 'SQ0218' AND Cast(Leg.datesta AS DATE) >= '08-OCT-2019' )
				OR ( Flt.flightkey = 'SQ7285' AND Cast(Leg.datesta AS DATE) >= '08-OCT-2019' )
				OR ( Flt.flightkey = 'SQ0238' AND Cast(Leg.datesta AS DATE) >= '08-OCT-2019' )
				OR ( Flt.flightkey = 'SQ0228' AND Cast(Leg.datesta AS DATE) >= '08-OCT-2019' )
				OR ( Flt.flightkey = 'SQ0248' AND Cast(Leg.datesta AS DATE) >= '08-OCT-2019' )
				OR ( Flt.flightkey = 'TR0025' AND Cast(Leg.datesta AS DATE) >= '08-OCT-2019' )
				OR ( Flt.flightkey = 'TR0019' AND Cast(Leg.datesta AS DATE) >= '08-OCT-2019' )
				OR ( Flt.flightkey = 'SQ0216' AND Cast(Leg.datesta AS DATE) >= '08-OCT-2019' )
				OR ( Flt.flightkey = 'SQ0224' AND Cast(Leg.datesta AS DATE) >= '08-OCT-2019' )
				OR ( Flt.flightkey = 'SQ0226' AND Cast(Leg.datesta AS DATE) >= '08-OCT-2019' )
				OR ( Flt.flightkey = 'SQ0214' AND Cast(Leg.datesta AS DATE) >= '08-OCT-2019' )
				OR ( Flt.flightkey = 'TR0017' AND Cast(Leg.datesta AS DATE) >= '08-OCT-2019' )
				OR ( Flt.flightkey = 'TR0009' AND Cast(Leg.datesta AS DATE) >= '08-OCT-2019' )
				OR ( Flt.flightkey = 'SQ0242' AND Cast(Leg.datesta AS DATE) >= '08-OCT-2019' )
				OR ( Flt.flightkey = 'SQ7127' AND Cast(Leg.datesta AS DATE) >= '08-OCT-2019' )
				OR ( Flt.flightkey = 'SQ0288' AND Cast(Leg.datesta AS DATE) >= '08-OCT-2019' )
				OR ( Flt.flightkey = 'SQ0212' AND Cast(Leg.datesta AS DATE) >= '08-OCT-2019' )
				OR ( Flt.flightkey = 'SQ0232' AND Cast(Leg.datesta AS DATE) >= '08-OCT-2019' )
				OR ( Flt.flightkey = 'SQ7295' AND Cast(Leg.datesta AS DATE) >= '08-OCT-2019' )
				OR ( Flt.flightkey = 'SQ0222' AND Cast(Leg.datesta AS DATE) >= '08-OCT-2019' )
				OR ( Flt.flightkey = 'TR0013' AND Cast(Leg.datesta AS DATE) >= '08-OCT-2019' )
				OR ( Flt.flightkey = 'TR0003' AND Cast(Leg.datesta AS DATE) >= '08-OCT-2019' )	
				OR ( Flt.flightkey = 'MI0804' AND Cast(Leg.datesta AS DATE) >= '15-OCT-2019' )
				OR ( Flt.flightkey = 'MI0812' AND Cast(Leg.datesta AS DATE) >= '15-OCT-2019' )
				OR ( Flt.flightkey = 'MI0814' AND Cast(Leg.datesta AS DATE) >= '15-OCT-2019' )
				OR ( Flt.flightkey = 'TR0007' AND Cast(Leg.datesta AS DATE) >= '15-OCT-2019' )	
				OR ( Flt.flightkey = 'MI0319' AND Cast(Leg.datesta AS DATE) >= '30-OCT-2019' )
				OR ( Flt.flightkey = 'MI0321' AND Cast(Leg.datesta AS DATE) >= '30-OCT-2019' )
				OR ( Flt.flightkey = 'MI0323' AND Cast(Leg.datesta AS DATE) >= '30-OCT-2019' )
				OR ( Flt.flightkey = 'MI0325' AND Cast(Leg.datesta AS DATE) >= '30-OCT-2019' )
				OR ( Flt.flightkey = 'MI0327' AND Cast(Leg.datesta AS DATE) >= '30-OCT-2019' )
				OR ( Flt.flightkey = 'MI0339' AND Cast(Leg.datesta AS DATE) >= '30-OCT-2019' )
				OR ( Flt.flightkey = 'MI0341' AND Cast(Leg.datesta AS DATE) >= '30-OCT-2019' )
				OR ( Flt.flightkey = 'SQ0107' AND Cast(Leg.datesta AS DATE) >= '30-OCT-2019' )
				OR ( Flt.flightkey = 'SQ0117' AND Cast(Leg.datesta AS DATE) >= '30-OCT-2019' )
				OR ( Flt.flightkey = 'SQ0119' AND Cast(Leg.datesta AS DATE) >= '30-OCT-2019' )
				OR ( Flt.flightkey = 'SQ3338' AND Cast(Leg.datesta AS DATE) >= '30-OCT-2019' )
				OR ( Flt.flightkey = 'SQ3342' AND Cast(Leg.datesta AS DATE) >= '30-OCT-2019' )
				OR ( Flt.flightkey = 'TR0453' AND Cast(Leg.datesta AS DATE) >= '30-OCT-2019' )
				OR ( Flt.flightkey = 'TR0457' AND Cast(Leg.datesta AS DATE) >= '30-OCT-2019' )
				OR ( Flt.flightkey = 'TR0465' AND Cast(Leg.datesta AS DATE) >= '30-OCT-2019' )
				OR ( Flt.flightkey = 'TR0467' AND Cast(Leg.datesta AS DATE) >= '30-OCT-2019' )
				OR ( Flt.flightkey = 'TR0469' AND Cast(Leg.datesta AS DATE) >= '30-OCT-2019' )				
				)   
),
Manifest As (SELECT ArrFlt.FlightId, Sum(ArrShp.Weight) Weight
			 FROM   Imp_ArrivalManifestShipmentInfo ArrShp 
		     INNER JOIN Imp_ArrivalManifestULD ArrUld       
			         ON ArrUld.ImpArrivalManifestULDId = ArrShp.ImpArrivalManifestULDId
	         INNER JOIN Imp_ArrivalManifestBySegment ManSeg 
					 ON ManSeg.ImpArrivalManifestBySegmentId = ArrUld.ImpArrivalManifestBySegmentId
		     INNER JOIN Imp_ArrivalManifestByFlight ArrFlt 
			         ON ArrFlt.ImpArrivalManifestByFlightId = ManSeg.ImpArrivalManifestByFlightId
			 Inner Join Flight Flt On Flt.FlightId = ArrFlt.FlightId
		     Inner Join Flt_operativeflight_Segments FltSeg 
			         On FltSeg.Flight_Id       = Flt.FlightId
			        And FltSeg.FlightSegmentId = ManSeg.FlightSegmentId 
			 Group By   ArrFlt.FlightId
),
Msca As (Select Flight_Id FlightId, Sum(IsNull(Weight,0)) Weight
		 From Shipment_Irregularity
		 Where CargoIrregularityCode In ('MSCA')
		 And Flight_Id Is Not NUll
		 Group By Flight_Id
),
Fdca As (Select Flight_Id FlightId, Sum(IsNull(Weight,0)) Weight
		 From Shipment_Irregularity
		 Where CargoIrregularityCode In ('FDCA')
		 And Flight_Id Is Not NUll
		 Group By Flight_Id
),
FrtIn As (Select Ver.FlightId, Sum(Ver.BreakDownWeight) Weight
          from Imp_ShipmentVerification Ver
		  Where IsNull(Ver.BreakDownPieces,0) > 0
		  Group By Ver.FlightId
),	
Inv As (Select IsNull(Inv.InboundFlightId,Inv.Flight_Id) FlightId,	
				Sum(Case When (IsNull(BUP,0) > 0 And IsNull(DGR,0) = 0 And IsNUll(PER,0) = 0)
					     Then Inv.Weight Else 0 End) BUP,				  
				Sum(Case When ((IsNUll(PER,0) > 0 And IsNull(BUP,0) = 0 And IsNull(DGR,0) = 0)
						   Or (IsNUll(PER,0) > 0 And IsNull(BUP,0) = 0 And IsNull(DGR,0) > 0)
						   Or (IsNUll(PER,0) > 0 And IsNull(BUP,0) > 0 And IsNull(DGR,0) > 0)) 
					     Then Inv.Weight Else 0 End) PER,	
				Sum(Case When (IsNull(BUP,0) > 0 And IsNull(PER,0) > 0 And IsNUll(DGR,0) = 0)
					     Then Inv.Weight Else 0 End) BUPPER, 
				Sum(Case When ((IsNull(DGR,0) > 0 And IsNUll(PER,0) = 0 And IsNull(BUP,0) = 0) 
						   OR (IsNull(DGR,0) > 0 And IsNUll(PER,0) = 0 And IsNull(BUP,0) > 0)) 
					     Then Inv.Weight Else 0 End) DGR, 						 
				Sum(Case When  (IsNull(BUP,0) = 0 And IsNull(DGR,0) = 0 And IsNUll(PER,0) = 0 )  
					     Then Inv.Weight Else 0 End) GEN		  
		From Shipment_Inventory Inv	
		Inner Join Shipment_Master sm On sm.ShipmentId = Inv.Shipment_Id
		Left Join (Select ShipmentInventoryId,	
							Sum(CASE WHEN specialhandlingcode IN ('BUP') 
									 THEN 1 ELSE 0 END) BUP,
							Sum(CASE WHEN specialhandlingcode IN ('EAT','FRI','FRO','LHO','PEF',
																  'PEM','PEP','PER','PES','PHC',
																  'PIL') 
									 THEN 1 ELSE 0 END) PER, 					
							Sum(CASE WHEN specialhandlingcode IN ('DGD','DGR','RBI','RBM','RCL',
																  'RCM','RCX','REQ','REX','RFG',
																  'RFL','RFS','RFW','RGX','RIS',
																  'RLI','RLM','RMD','RNG','ROP',
																  'ROX','RPB','RPG','RRE','RRW',
																  'RRY','RSB','RSC','RXB','RXC',
																  'RXD','RXE','RXG','RXS') 
									 THEN 1 ELSE 0 END) DGR
					From   Shipment_InventoryShc 
					Group By ShipmentInventoryId
				  ) Shc On Shc.ShipmentInventoryId = Inv.ShipmentInventory_Id
			Where sm.Origin != 'SIN'
			And sm.ShipmentType != 'MAIL'				  
			Group By IsNull(InboundFlightId,Inv.Flight_Id)
),
FOut As (Select IsNull(FOut.InboundFlightId,FOut.FlightId) FlightId,	
				Sum(Case When (IsNull(BUP,0) > 0 And IsNull(DGR,0) = 0 And IsNUll(PER,0) = 0)
					     Then FOut.Weight Else 0 End) BUP, 				  
				Sum(Case When ((IsNUll(PER,0) > 0 And IsNull(BUP,0) = 0 And IsNull(DGR,0) = 0)
						   Or (IsNUll(PER,0) > 0 And IsNull(BUP,0) = 0 And IsNull(DGR,0) > 0)
						   Or (IsNUll(PER,0) > 0 And IsNull(BUP,0) > 0 And IsNull(DGR,0) > 0)) 
					     Then FOut.Weight Else 0 End) PER,
				Sum(Case When (IsNull(BUP,0) > 0 And IsNull(PER,0) > 0 And IsNUll(DGR,0) = 0)
					     Then FOut.Weight Else 0 End) BUPPER, 						 
				Sum(Case When ((IsNull(DGR,0) > 0 And IsNUll(PER,0) = 0 And IsNull(BUP,0) = 0) 
						   OR (IsNull(DGR,0) > 0 And IsNUll(PER,0) = 0 And IsNull(BUP,0) > 0)) 
					     Then FOut.Weight Else 0 End) DGR,						 
				Sum(Case When (IsNull(BUP,0) = 0 And IsNull(DGR,0) = 0 And IsNUll(PER,0) = 0)  
					     Then FOut.Weight Else 0 End) GEN		  
		From Shipment_Freightout FOut	
		Inner Join Shipment_Master sm On sm.ShipmentId = FOut.ShipmentId
		Left Join (Select ShipmentFreightOutId,	
						  Sum(CASE WHEN specialhandlingcode IN ('BUP') 
							       THEN 1 ELSE 0 END) BUP,
						  Sum(CASE WHEN specialhandlingcode IN ('EAT','FRI','FRO','LHO','PEF',
																'PEM','PEP','PER','PES','PHC',
																'PIL') 
								   THEN 1 ELSE 0 END) PER, 					
						  Sum(CASE WHEN specialhandlingcode IN ('DGD','DGR','RCL','RCM','RCS',
																'RCX','RDG','REX','RFL',
																'RFS','RFW','RGX','RIS','RLI',
																'RLM','RMD','ROP','ROX','RPB',
																'RPG','RRE','RRW','RRY','RSB',
																'RSC','RXB','RXC','RXD') 
								   THEN 1 ELSE 0 END) DGR
					From   Shipment_FreightoutShc 
					Group By ShipmentFreightOutId
				   ) Shc On Shc.ShipmentFreightOutId = FOut.ShipmentFreightOutId
		Where sm.Origin != 'SIN'
		And sm.ShipmentType != 'MAIL'
		Group By IsNull(InboundFlightId,FOut.FlightId)
),
InvFOut As (Select FlightId, Sum(BUP) BUP, Sum(PER) PER, Sum(BUPPER) BUPPER, Sum(DGR) DGR, Sum(GEN) GEN
			From (Select FlightId, BUP, PER, BUPPER, DGR, GEN 
				  From Inv
				  Union All 
				  Select FlightId, BUP, PER, BUPPER, DGR, GEN 
				  From FOut) A
			Group By FlightId
),
Tonnage As (SELECT Flt.FlightDate, Flt.FlightKey Flight, 
				   IsNull(Man.Weight,0) Manifest_WGT, 
				   IsNull(Msca.Weight,0) Missing_Cargo, IsNull(Fdca.Weight,0) Found_Cargo, 
				   FrtIn.Weight FrtIn_WGT,
				   InvFOut.BUP, InvFOut.PER, InvFOut.BUPPER, InvFOut.DGR, InvFOut.GEN,
				   (IsNull(InvFOut.BUP,0)+IsNull(InvFOut.PER,0)+IsNull(InvFOut.BUPPER,0)+
				   IsNull(InvFOut.DGR,0)+IsNull(InvFOut.GEN,0)) Billing_Total	   
			FROM   FrtIn
			Inner Join Flight Flt On Flt.FlightID = FrtIn.FlightID
			Left  Join Manifest Man On Man.FlightId = FrtIn.FlightID
			Left  Join Msca On Msca.FlightId = Man.FlightId
			Left  Join Fdca On Fdca.FlightId = Man.FlightId
			Left  Join InvFOut ON InvFOut.FlightId = FrtIn.FlightId
)
Select FlightDate, Flight, Manifest_WGT, 
       Missing_Cargo, Found_Cargo, ((Manifest_WGT+Found_Cargo)-Missing_Cargo) Final_Manifest,
	   FrtIn_WGT, BUP, PER, BUPPER, DGR, GEN,
	   Billing_Total, Billing_Total-FrtIn_WGT "Variance (kg)",
	   ((Billing_Total-FrtIn_WGT) / FrtIn_WGT) "Variance %"
From Tonnage		
Where Cast(FlightDate As Date) Between ? And ? 
Order by 1, 2]]></xml-property>
        </oda-data-set>
    </data-sets>
    <page-setup>
        <simple-master-page name="Simple MasterPage" id="2">
            <property name="orientation">landscape</property>
        </simple-master-page>
    </page-setup>
    <body>
        <grid id="142">
            <column id="143"/>
            <row id="144">
                <cell id="145">
                    <label id="146">
                        <property name="fontFamily">"Courier New"</property>
                        <property name="fontWeight">bold</property>
                        <property name="textAlign">left</property>
                        <text-property name="text">                                   IMPORT DAILY TONNAGE VERIFICATION(FLIGHT)</text-property>
                    </label>
                </cell>
            </row>
        </grid>
        <table id="147">
            <property name="fontFamily">"Courier New"</property>
            <property name="dataSet">Data Set</property>
            <list-property name="boundDataColumns">
                <structure>
                    <property name="name">FlightDate</property>
                    <text-property name="displayName">FlightDate</text-property>
                    <expression name="expression" type="javascript">dataSetRow["FlightDate"]</expression>
                    <property name="dataType">string</property>
                </structure>
                <structure>
                    <property name="name">Flight</property>
                    <text-property name="displayName">Flight</text-property>
                    <expression name="expression" type="javascript">dataSetRow["Flight"]</expression>
                    <property name="dataType">string</property>
                </structure>
                <structure>
                    <property name="name">Manifest_WGT</property>
                    <text-property name="displayName">Manifest_WGT</text-property>
                    <expression name="expression" type="javascript">dataSetRow["Manifest_WGT"]</expression>
                    <property name="dataType">decimal</property>
                </structure>
                <structure>
                    <property name="name">Missing_Cargo</property>
                    <text-property name="displayName">Missing_Cargo</text-property>
                    <expression name="expression" type="javascript">dataSetRow["Missing_Cargo"]</expression>
                    <property name="dataType">decimal</property>
                </structure>
                <structure>
                    <property name="name">Found_Cargo</property>
                    <text-property name="displayName">Found_Cargo</text-property>
                    <expression name="expression" type="javascript">dataSetRow["Found_Cargo"]</expression>
                    <property name="dataType">decimal</property>
                </structure>
                <structure>
                    <property name="name">Final_Manifest</property>
                    <text-property name="displayName">Final_Manifest</text-property>
                    <expression name="expression" type="javascript">dataSetRow["Final_Manifest"]</expression>
                    <property name="dataType">decimal</property>
                </structure>
                <structure>
                    <property name="name">FrtIn_WGT</property>
                    <text-property name="displayName">FrtIn_WGT</text-property>
                    <expression name="expression" type="javascript">dataSetRow["FrtIn_WGT"]</expression>
                    <property name="dataType">decimal</property>
                </structure>
                <structure>
                    <property name="name">BUP</property>
                    <text-property name="displayName">BUP</text-property>
                    <expression name="expression" type="javascript">dataSetRow["BUP"]</expression>
                    <property name="dataType">decimal</property>
                </structure>
                <structure>
                    <property name="name">PER</property>
                    <text-property name="displayName">PER</text-property>
                    <expression name="expression" type="javascript">dataSetRow["PER"]</expression>
                    <property name="dataType">decimal</property>
                </structure>
                <structure>
                    <property name="name">BUPPER</property>
                    <text-property name="displayName">BUPPER</text-property>
                    <expression name="expression" type="javascript">dataSetRow["BUPPER"]</expression>
                    <property name="dataType">decimal</property>
                </structure>
                <structure>
                    <property name="name">DGR</property>
                    <text-property name="displayName">DGR</text-property>
                    <expression name="expression" type="javascript">dataSetRow["DGR"]</expression>
                    <property name="dataType">decimal</property>
                </structure>
                <structure>
                    <property name="name">GEN</property>
                    <text-property name="displayName">GEN</text-property>
                    <expression name="expression" type="javascript">dataSetRow["GEN"]</expression>
                    <property name="dataType">decimal</property>
                </structure>
                <structure>
                    <property name="name">Billing_Total</property>
                    <text-property name="displayName">Billing_Total</text-property>
                    <expression name="expression" type="javascript">dataSetRow["Billing_Total"]</expression>
                    <property name="dataType">decimal</property>
                </structure>
                <structure>
                    <property name="name">Variance (kg)</property>
                    <text-property name="displayName">Variance (kg)</text-property>
                    <expression name="expression" type="javascript">dataSetRow["Variance (kg)"]</expression>
                    <property name="dataType">decimal</property>
                </structure>
                <structure>
                    <property name="name">Variance %</property>
                    <text-property name="displayName">Variance %</text-property>
                    <expression name="expression" type="javascript">dataSetRow["Variance %"]</expression>
                    <property name="dataType">decimal</property>
                </structure>
            </list-property>
            <property name="pageBreakInterval">0</property>
            <column id="196"/>
            <column id="197"/>
            <column id="198"/>
            <column id="199"/>
            <column id="200"/>
            <column id="201"/>
            <column id="202"/>
            <column id="203"/>
            <column id="204"/>
            <column id="205"/>
            <column id="206"/>
            <column id="207"/>
            <column id="208"/>
            <column id="209"/>
            <column id="210"/>
            <header>
                <row id="148">
                    <cell id="149">
                        <label id="211">
                            <text-property name="text">Flight</text-property>
                        </label>
                    </cell>
                    <cell id="150">
                        <label id="212">
                            <text-property name="text">Flight Date</text-property>
                        </label>
                    </cell>
                    <cell id="151">
                        <label id="213">
                            <property name="textAlign">left</property>
                            <text-property name="text">Manifest Weight</text-property>
                        </label>
                    </cell>
                    <cell id="152">
                        <label id="214">
                            <property name="textAlign">left</property>
                            <text-property name="text">Missing Cargo</text-property>
                        </label>
                    </cell>
                    <cell id="153">
                        <label id="215">
                            <property name="textAlign">left</property>
                            <text-property name="text">Found Cargo</text-property>
                        </label>
                    </cell>
                    <cell id="154">
                        <label id="216">
                            <property name="textAlign">left</property>
                            <text-property name="text">Final Manifest</text-property>
                        </label>
                    </cell>
                    <cell id="155">
                        <label id="217">
                            <property name="textAlign">left</property>
                            <text-property name="text">Freight in Weight</text-property>
                        </label>
                    </cell>
                    <cell id="156">
                        <label id="218">
                            <text-property name="text">BUP</text-property>
                        </label>
                    </cell>
                    <cell id="157">
                        <label id="219">
                            <text-property name="text">PER</text-property>
                        </label>
                    </cell>
                    <cell id="158">
                        <label id="220">
                            <text-property name="text">BUPPER</text-property>
                        </label>
                    </cell>
                    <cell id="159">
                        <label id="221">
                            <text-property name="text">DGR</text-property>
                        </label>
                    </cell>
                    <cell id="160">
                        <label id="222">
                            <text-property name="text">GEN</text-property>
                        </label>
                    </cell>
                    <cell id="161">
                        <label id="62">
                            <property name="textAlign">left</property>
                            <text-property name="text">Total Billing</text-property>
                        </label>
                    </cell>
                    <cell id="162">
                        <label id="63">
                            <property name="textAlign">left</property>
                            <text-property name="text">Varience KG</text-property>
                        </label>
                    </cell>
                    <cell id="163">
                        <label id="64">
                            <property name="textAlign">left</property>
                            <text-property name="text">Varience %</text-property>
                        </label>
                    </cell>
                </row>
            </header>
            <detail>
                <row id="164">
                    <cell id="165">
                        <data id="239">
                            <property name="resultSetColumn">Flight</property>
                        </data>
                    </cell>
                    <cell id="166">
                        <data id="238">
                            <property name="resultSetColumn">FlightDate</property>
                        </data>
                    </cell>
                    <cell id="167">
                        <data id="237">
                            <property name="textAlign">right</property>
                            <property name="resultSetColumn">Manifest_WGT</property>
                        </data>
                    </cell>
                    <cell id="168">
                        <data id="236">
                            <property name="textAlign">right</property>
                            <property name="resultSetColumn">Missing_Cargo</property>
                        </data>
                    </cell>
                    <cell id="169">
                        <data id="235">
                            <property name="textAlign">right</property>
                            <property name="resultSetColumn">Found_Cargo</property>
                        </data>
                    </cell>
                    <cell id="170">
                        <data id="234">
                            <property name="textAlign">right</property>
                            <property name="resultSetColumn">Final_Manifest</property>
                        </data>
                    </cell>
                    <cell id="171">
                        <data id="230">
                            <property name="textAlign">right</property>
                            <property name="resultSetColumn">FrtIn_WGT</property>
                        </data>
                    </cell>
                    <cell id="172">
                        <data id="229">
                            <property name="textAlign">right</property>
                            <property name="resultSetColumn">BUP</property>
                        </data>
                    </cell>
                    <cell id="173">
                        <data id="228">
                            <property name="textAlign">right</property>
                            <property name="resultSetColumn">PER</property>
                        </data>
                    </cell>
                    <cell id="174">
                        <data id="227">
                            <property name="textAlign">right</property>
                            <property name="resultSetColumn">BUPPER</property>
                        </data>
                    </cell>
                    <cell id="175">
                        <data id="226">
                            <property name="textAlign">right</property>
                            <property name="resultSetColumn">DGR</property>
                        </data>
                    </cell>
                    <cell id="176">
                        <data id="225">
                            <property name="textAlign">right</property>
                            <property name="resultSetColumn">GEN</property>
                        </data>
                    </cell>
                    <cell id="177">
                        <data id="224">
                            <property name="textAlign">right</property>
                            <property name="resultSetColumn">Billing_Total</property>
                        </data>
                    </cell>
                    <cell id="178">
                        <data id="232">
                            <property name="textAlign">right</property>
                            <property name="resultSetColumn">Variance (kg)</property>
                        </data>
                    </cell>
                    <cell id="179">
                        <data id="233">
                            <property name="textAlign">right</property>
                            <property name="resultSetColumn">Variance %</property>
                        </data>
                    </cell>
                </row>
            </detail>
            <footer>
                <row id="180">
                    <cell id="181"/>
                    <cell id="182"/>
                    <cell id="183"/>
                    <cell id="184"/>
                    <cell id="185"/>
                    <cell id="186"/>
                    <cell id="187"/>
                    <cell id="188"/>
                    <cell id="189"/>
                    <cell id="190"/>
                    <cell id="191"/>
                    <cell id="192"/>
                    <cell id="193"/>
                    <cell id="194"/>
                    <cell id="195"/>
                </row>
            </footer>
        </table>
    </body>
</report>
